{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\Http/assets\\scripts\\Http\\NetWork.ts"],"names":[],"mappings":";;;;;;AAAA,iDAAgD;AAChD,kDAAiD;AACjD,qDAAgD;AAChD;IAAA;IAwKA,CAAC;IAxIU,mBAAW,GAAlB;QACI,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,EAAE;YACvB,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO,EAAE,CAAC;SACjC;QACD,OAAO,IAAI,CAAC,QAAQ,CAAC;IACzB,CAAC;IAED;;;;;;;OAOG;IACH,6BAAW,GAAX,UAAY,GAAG,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAe,EAAE,MAAW;QAA5B,yBAAA,EAAA,eAAe;QAAE,uBAAA,EAAA,WAAW;QAChE,IAAI,uBAAU,CAAC,UAAU,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAC,iBAAiB;YAC9D,qBAAS,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,oBAAU,EAAE,IAAI,EAAE,IAAI,EAAE;gBAClD,qBAAS,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,oBAAU,CAAgB,CAAC,QAAQ,CAC9D,kBAAkB,EAClB,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,CAAC;YACtB,CAAC,CAAC,CAAC;YACH,OAAO;SACV;aAAM,IAAI,CAAC,uBAAU,CAAC,UAAU,IAAI,CAAC,CAAC,OAAO,CAAC,aAAa,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,EAAC,6BAA6B;YAC7G,qBAAS,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,oBAAU,EAAE,IAAI,EAAE,IAAI,EAAE;gBAClD,qBAAS,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,oBAAU,CAAgB,CAAC,QAAQ,CAC9D,iBAAiB,EACjB,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,CAAC;YACtB,CAAC,CAAC,CAAC;YACH,OAAO;SACV;QAED,IAAI,GAAG,GAAG,IAAI,cAAc,EAAE,CAAC;QAC/B,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;QACxB,GAAG,CAAC,OAAO,GAAG,KAAK,CAAC;QACpB,GAAG,CAAC,gBAAgB,CAAC,cAAc,EAAE,WAAW,CAAC,CAAC;QAClD,GAAG,CAAC,eAAe,GAAG,IAAI,CAAC;QAE3B,IAAI;QACJ,GAAG,CAAC,kBAAkB,GAAG;YACrB,OAAO,CAAC,GAAG,CAAC,wBAAwB,EAAE,GAAG,CAAC,MAAM,EAAE,wBAAwB,EAAE,GAAG,CAAC,UAAU,EAAE,0BAA0B,EAAE,GAAG,CAAC,YAAY,CAAC,CAAC;YAC1I,IAAI,GAAG,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,IAAI,GAAG,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,CAAC,EAAE;gBACjE,IAAI,UAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;gBAC5C,IAAI,QAAQ,IAAI,UAAQ,CAAC,OAAO,IAAI,CAAC,EAAE;oBACnC,QAAQ,CAAC,KAAK,EAAE,UAAQ,CAAC,CAAC;iBAC7B;qBAAM;oBACH,IAAI,uBAAU,CAAC,WAAW,EAAE;wBACxB,qBAAS,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,oBAAU,EAAE,IAAI,EAAE,IAAI,EAAE;4BAClD,qBAAS,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,oBAAU,CAAgB,CAAC,QAAQ,CAAC,UAAQ,CAAC,MAAM,GAAG,SAAS,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE;gCAC1G,OAAO,CAAC,WAAW,EAAE,CAAC,WAAW,CAAC,GAAG,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;4BACpF,CAAC,EAAE,KAAK,CAAC,CAAC;wBACd,CAAC,CAAC,CAAC;qBACN;iBACJ;aACJ;QACL,CAAC,CAAC;QAEF,MAAM;QACN,GAAG,CAAC,SAAS,GAAG,UAAU,KAAK;YAC3B,IAAI,uBAAU,CAAC,WAAW,EAAE;gBACxB,qBAAS,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,oBAAU,EAAE,IAAI,EAAE,IAAI,EAAE;oBAClD,qBAAS,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,oBAAU,CAAgB,CAAC,QAAQ,CAAC,YAAY,EAAE,EAAE,EAAE,eAAe,EAAE,MAAM,EAAE;wBAC1G,OAAO,CAAC,WAAW,EAAE,CAAC,WAAW,CAAC,GAAG,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;oBACpF,CAAC,EAAE,IAAI,CAAC,CAAC;gBACb,CAAC,CAAC,CAAC;aACN;YACD,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;YACnC,QAAQ,IAAI,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QACrC,CAAC,CAAC;QAEF,IAAI;QACJ,GAAG,CAAC,OAAO,GAAG,UAAU,KAAK;YACzB,IAAI,uBAAU,CAAC,WAAW,EAAE;gBACxB,qBAAS,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,oBAAU,EAAE,IAAI,EAAE,IAAI,EAAE;oBAClD,qBAAS,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,oBAAU,CAAgB,CAAC,QAAQ,CAAC,YAAY,EAAE,eAAe,EAAE,EAAE,EAAE,MAAM,EAAE;wBAC1G,OAAO,CAAC,WAAW,EAAE,CAAC,WAAW,CAAC,GAAG,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;oBACpF,CAAC,EAAE,IAAI,CAAC,CAAC;gBACb,CAAC,CAAC,CAAC;aACN;YACD,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;YACjC,QAAQ,IAAI,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QACrC,CAAC,CAAA;QAED,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IACrB,CAAC;IAED;;OAEG;IACH,4BAAU,GAAV;QACI,IAAI,OAAO,CAAC,UAAU,IAAI,IAAI,EAAE;YAC5B,OAAO,OAAO,CAAC,UAAU,CAAC;SAC7B;QACD,OAAO,CAAC,UAAU,GAAG,IAAI,MAAM,EAAE,CAAC;QAClC,IAAI,GAAG,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC,gBAAgB;QAC3C,2BAA2B;QAE3B,IAAI,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE;YACxB,IAAI,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACxB,IAAI,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC1B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAClC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;aACzF;SACJ;QACD,OAAO,CAAC,aAAa,GAAG,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACjD,OAAO,CAAC,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;QAClD,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QAChD,OAAO,CAAC,KAAK,GAAG,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QAC5C,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAC9C,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,EAAE,CAAC,CAAA;QAC/C,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,OAAO,CAAC,aAAa,EAAE,aAAa,EAAE,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC;QAC9I,OAAO,OAAO,CAAC,UAAU,CAAC;IAE9B,CAAC;IAED,6BAAW,GAAX;QACI,IAAI,QAAQ,GAAG,CAAC,CAAC;QACjB,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC,UAAU,CAAC,EAAE;YAC/B,QAAQ,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,UAAU,CAAC,CAAA;SAC3C;QACD,OAAO,QAAQ,CAAC;IACpB,CAAC;IAED,kCAAgB,GAAhB,UAAiB,SAAS,EAAE,IAAI;QAC5B,IAAI,uBAAU,CAAC,WAAW,EAAE;YACxB,IAAI,GAAG,GAAG,IAAI,KAAK,EAAE,CAAC;YACtB,GAAG,CAAC,GAAG,GAAG,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,oDAAoD,CAAC,CAAC,CAAC,gDAAgD,CAAC;gBACrI,YAAY,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,IAAI,CAAC;gBACtC,cAAc,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,YAAY,CAAC;gBAChD,WAAW,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,SAAS,CAAC;gBAC1C,WAAW,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,SAAS,CAAC;gBAC1C,SAAS,GAAG,SAAS;gBACrB,aAAa;gBACb,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,QAAQ,EAAE,aAAa,EAAE,uBAAU,CAAC,aAAa,EAAE,KAAK,EAAE,IAAI,CAAC,UAAU,EAAE,CAAC,OAAO,CAAC,EAAE,cAAc,EAAE,WAAW,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;SAC1K;IACL,CAAC;IApKD,SAAS;IACc,mBAAW,GAAG,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC,WAAW,EAAE,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;IACxI,kBAAU,GAAG,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,QAAQ,CAAC,CAAC;IAC9E,aAAa;IACU,eAAO,GAAG,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,UAAU,CAAC;IACjG,eAAe;IACQ,cAAM,GAAG,QAAQ,CAAC,QAAQ,IAAI,OAAO,IAAI,QAAQ,CAAC,QAAQ,IAAI,OAAO,CAAC;IACtE,YAAI,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,gCAAgC,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,qCAAqC,CAAC,CAAC,CAAC,sCAAsC,CAAC;IAGjK,oBAAY,GAAG,OAAO,CAAC,IAAI,GAAG,MAAM,CAAC;IACrC,yBAAiB,GAAG,OAAO,CAAC,IAAI,GAAG,aAAa,CAAC;IACjD,iBAAS,GAAG,OAAO,CAAC,IAAI,GAAG,YAAY,CAAC;IACxC,WAAG,GAAG,OAAO,CAAC,IAAI,GAAG,MAAM,CAAC;IAC5B,cAAM,GAAG,OAAO,CAAC,IAAI,GAAG,SAAS,CAAC;IAClC,aAAK,GAAG,OAAO,CAAC,IAAI,GAAG,QAAQ,CAAC;IAEzC,qBAAa,GAAG,IAAI,CAAC;IACrB,gBAAQ,GAAG,IAAI,CAAC;IAChB,eAAO,GAAG,IAAI,CAAC;IAEf,aAAK,GAAY,KAAK,CAAC,CAAA,6BAA6B;IAEpD,kBAAU,GAAG,IAAI,CAAC;IAClB,eAAO,GAAG,IAAI,CAAC;IAC7B,iCAAiC;IACnB,cAAM,GAAG,IAAI,CAAC;IAEb,kBAAU,GAAG,IAAI,CAAC;IAyIrC,cAAC;CAxKD,AAwKC,IAAA;AAxKY,0BAAO","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Http","sourcesContent":["import { ConstValue } from \"../Data/ConstValue\";\nimport { UIManager } from \"../Manager/UIManager\";\nimport ErrorPanel from \"../UI/panel/ErrorPanel\";\nexport class NetWork {\n    private static instance: NetWork;\n\n    //判断是否是线上\n    public static readonly isOnlineEnv = location.host.indexOf('ceshi-') < 0 && location.host.indexOf('localhost') < 0 && NetWork.getInstance().GetIsOnline() == 1;\n    public static readonly isProtocol = /http:/.test(window['location'].protocol);\n    //判断协议是否为http\n    public static readonly isLocal = /localhost/.test(window['location'].href) || NetWork.isProtocol;\n    //判断是否是pc预加载的协议\n    public static readonly isOwcr = location.protocol == 'owcr:' || location.protocol == 'file:';\n    public static readonly BASE = NetWork.isOnlineEnv ? 'https://courseware.haibian.com' : NetWork.isLocal ? 'http://ceshi.courseware.haibian.com' : 'https://ceshi_courseware.haibian.com';\n\n\n    public static readonly GET_QUESTION = NetWork.BASE + '/get';\n    public static readonly GET_USER_PROGRESS = NetWork.BASE + '/get/answer';\n    public static readonly GET_TITLE = NetWork.BASE + \"/get/title\";\n    public static readonly ADD = NetWork.BASE + \"/add\";\n    public static readonly MODIFY = NetWork.BASE + \"/modify\";\n    public static readonly CLEAR = NetWork.BASE + \"/clear\";\n\n    public static courseware_id = null;\n    public static title_id = null;\n    public static user_id = null;\n\n    public static empty: boolean = false;//清理脏数据的开关，在URL里面拼此参数 = true；\n\n    public static chapter_id = null;\n    public static subject = null;\n    /*isLive参数已添加，直播课参数传YES，回放传NO  */\n    public static isLive = null;\n\n    private static theRequest = null;\n    static getInstance() {\n        if (this.instance == null) {\n            this.instance = new NetWork();\n        }\n        return this.instance;\n    }\n\n    /**\n     * 请求网络Post 0成功 1超时\n     * @param url \n     * @param openType \n     * @param contentType \n     * @param callback \n     * @param params \n     */\n    httpRequest(url, openType, contentType, callback = null, params = \"\") {\n        if (ConstValue.IS_TEACHER && !NetWork.title_id) {//教师端没有titleId的情况\n            UIManager.getInstance().openUI(ErrorPanel, null, 1000, () => {\n                (UIManager.getInstance().getUI(ErrorPanel) as ErrorPanel).setPanel(\n                    \"URL参数错误,请联系技术人员！\",\n                    \"\", \"\", \"确定\");\n            });\n            return;\n        } else if (!ConstValue.IS_TEACHER && (!NetWork.courseware_id || !NetWork.user_id)) {//学生端没有userid或coursewareId的情况\n            UIManager.getInstance().openUI(ErrorPanel, null, 1000, () => {\n                (UIManager.getInstance().getUI(ErrorPanel) as ErrorPanel).setPanel(\n                    \"异常编号为001,请联系客服！\",\n                    \"\", \"\", \"确定\");\n            });\n            return;\n        }\n\n        var xhr = new XMLHttpRequest();\n        xhr.open(openType, url);\n        xhr.timeout = 10000;\n        xhr.setRequestHeader(\"Content-Type\", contentType);\n        xhr.withCredentials = true;\n\n        //回调\n        xhr.onreadystatechange = function () {\n            console.log(\"httpRequest rsp status\", xhr.status, \"        xhr.readyState\", xhr.readyState, \"        xhr.responseText\", xhr.responseText);\n            if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status <= 400)) {\n                let response = JSON.parse(xhr.responseText);\n                if (callback && response.errcode == 0) {\n                    callback(false, response);\n                } else {\n                    if (ConstValue.IS_EDITIONS) {\n                        UIManager.getInstance().openUI(ErrorPanel, null, 1000, () => {\n                            (UIManager.getInstance().getUI(ErrorPanel) as ErrorPanel).setPanel(response.errmsg + \",请联系客服！\", \"\", \"\", \"确定\", () => {\n                                NetWork.getInstance().httpRequest(url, openType, contentType, callback, params);\n                            }, false);\n                        });\n                    }\n                }\n            }\n        };\n\n        //超时回调\n        xhr.ontimeout = function (event) {\n            if (ConstValue.IS_EDITIONS) {\n                UIManager.getInstance().openUI(ErrorPanel, null, 1000, () => {\n                    (UIManager.getInstance().getUI(ErrorPanel) as ErrorPanel).setPanel(\"网络不佳，请稍后重试\", \"\", \"若重新连接无效，请联系客服\", \"重新连接\", () => {\n                        NetWork.getInstance().httpRequest(url, openType, contentType, callback, params);\n                    }, true);\n                });\n            }\n            console.log('httpRequest timeout');\n            callback && callback(true, null);\n        };\n\n        //出错\n        xhr.onerror = function (error) {\n            if (ConstValue.IS_EDITIONS) {\n                UIManager.getInstance().openUI(ErrorPanel, null, 1000, () => {\n                    (UIManager.getInstance().getUI(ErrorPanel) as ErrorPanel).setPanel(\"网络出错，请稍后重试\", \"若重新连接无效，请联系客服\", \"\", \"重新连接\", () => {\n                        NetWork.getInstance().httpRequest(url, openType, contentType, callback, params);\n                    }, true);\n                });\n            }\n            console.log('httpRequest error');\n            callback && callback(true, null);\n        }\n\n        xhr.send(params);\n    }\n\n    /**\n     * 获取url参数\n     */\n    GetRequest() {\n        if (NetWork.theRequest != null) {\n            return NetWork.theRequest;\n        }\n        NetWork.theRequest = new Object();\n        var url = location.search; //获取url中\"?\"符后的字串\n        // var url = location.href;\n\n        if (url.indexOf(\"?\") != -1) {\n            var str = url.substr(1);\n            var strs = str.split(\"&\");\n            for (var i = 0; i < strs.length; i++) {\n                NetWork.theRequest[strs[i].split(\"=\")[0]] = decodeURIComponent(strs[i].split(\"=\")[1]);\n            }\n        }\n        NetWork.courseware_id = NetWork.theRequest[\"id\"];\n        NetWork.title_id = NetWork.theRequest[\"title_id\"];\n        NetWork.user_id = NetWork.theRequest[\"user_id\"];\n        NetWork.empty = NetWork.theRequest[\"empty\"];\n        NetWork.isLive = NetWork.theRequest['isLive'];\n        this.LogJournalReport('CoursewareLogEvent', '')\n        console.log('11111gaolei', NetWork.courseware_id, '           ', NetWork.theRequest['id'], '           ', JSON.stringify(NetWork.theRequest));\n        return NetWork.theRequest;\n\n    }\n\n    GetIsOnline() {\n        let isOnline = 1;\n        if (this.GetRequest()[\"isOnline\"]) {\n            isOnline = this.GetRequest()[\"isOnline\"]\n        }\n        return isOnline;\n    }\n\n    LogJournalReport(errorType, data) {\n        if (ConstValue.IS_EDITIONS) {\n            var img = new Image();\n            img.src = (NetWork.isOnlineEnv ? 'https://logserver.haibian.com/statistical/?type=7&' : 'https://ceshi-statistical.haibian.com/?type=7&') +\n                'course_id=' + this.GetRequest()[\"id\"] +\n                \"&chapter_id=\" + this.GetRequest()[\"chapter_id\"] +\n                \"&user_id=\" + this.GetRequest()[\"user_id\"] +\n                \"&subject=\" + this.GetRequest()[\"subject\"] +\n                \"&event=\" + errorType +\n                \"&identity=1\" +\n                \"&extra=\" + JSON.stringify({ url: location, CoursewareKey: ConstValue.CoursewareKey, empty: this.GetRequest()[\"empty\"], CoursewareName: 'pinyinshu', data: data });\n        }\n    }\n}"]}